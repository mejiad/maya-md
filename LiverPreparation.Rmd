---
title: "LiverPreparation"
author: "Daniel Mejia"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(ggplot2)
library(tidyverse)
```

# Liver Group

Select the rows with not null in the following attributes:

- Total.Protein...Serum 
- Total.Bilirubin...Serum 
- Direct.Bilirubin...Serum 
- Indirect.Bilirubin...Serum 
- Albumin...Serum 
- Alkaline.Phosphatase...Serum 
- Alanine.Transaminase..SGPT.ALT....Serum 
- Aspartate.Transaminase..SGOT.AST....Serum 
- SGOT...SGPT.Ratio 
- Globulin...Serum



# Reading original data

```{r data, include=TRUE}
data <- read_excel("MayaMD_1587.xlsx")
```

### Convert to data frame
```{r convert_to_dataframe, echo=FALSE}

df <- data.frame(data)
```


## Convert values to numeric all the required attributes
```{r}
df_mod <- transform(df, Total.Protein...Serum = as.numeric(Total.Protein...Serum));
df_mod <- transform(df_mod, Total.Bilirubin...Serum = as.numeric(Total.Bilirubin...Serum))
df_mod <- transform(df_mod, Direct.Bilirubin...Serum = as.numeric(Direct.Bilirubin...Serum))
df_mod <- transform(df_mod, Indirect.Bilirubin...Serum = as.numeric(Indirect.Bilirubin...Serum));
df_mod <- transform(df_mod, Albumin...Serum = as.numeric(Albumin...Serum));
df_mod <- transform(df_mod, Alkaline.Phosphatase...Serum = as.numeric(Alkaline.Phosphatase...Serum));
df_mod <- transform(df_mod, Alanine.Transaminase..SGPT.ALT....Serum = as.numeric(Alanine.Transaminase..SGPT.ALT....Serum))
df_mod <- transform(df_mod, Aspartate.Transaminase..SGOT.AST....Serum = as.numeric(Aspartate.Transaminase..SGOT.AST....Serum));
df_mod <- transform(df_mod, SGOT...SGPT.Ratio = as.numeric(SGOT...SGPT.Ratio));
df_mod <- transform(df_mod, Globulin...Serum = as.numeric(Globulin...Serum));
```

# Histograms for every feature

## T. Protein Serum 
```{r}
df_mod %>% filter(!is.na(Total.Protein...Serum)) %>% ggplot(aes(x=Total.Protein...Serum )) + geom_histogram(alpha=0.5) 
```


## Total.Bilirubin
```{r}
df_mod %>% filter(!is.na(Total.Bilirubin...Serum)) %>% ggplot(aes(x=Total.Bilirubin...Serum )) + geom_histogram(alpha=0.5) 
```


## Direct Bilirubin
```{r}
df_mod %>% filter(!is.na(Direct.Bilirubin...Serum)) %>% ggplot(aes(x=Direct.Bilirubin...Serum )) + geom_histogram(alpha=0.5) 
```

## Indirect Bilirubin
```{r}
df_mod %>% filter(!is.na(Indirect.Bilirubin...Serum)) %>% ggplot(aes(x=Indirect.Bilirubin...Serum )) + geom_histogram(alpha=0.5) 
```


## Albumin Serum
```{r}
df_mod %>% filter(!is.na(Albumin...Serum)) %>% ggplot(aes(x=Albumin...Serum )) + geom_histogram(alpha=0.5) 
```


## Alkaline Phosphatese
```{r}
df_mod %>% filter(!is.na(Alkaline.Phosphatase...Serum)) %>% ggplot(aes(x=Alkaline.Phosphatase...Serum )) + geom_histogram(alpha=0.5) 
```

## Alanine Transaminase
```{r}
df_mod %>% filter(!is.na( Alanine.Transaminase..SGPT.ALT....Serum)) %>% ggplot(aes(x=Alanine.Transaminase..SGPT.ALT....Serum)) + geom_histogram(alpha=0.5) 
```

## Aspartate Transaminase
```{r}
df_mod %>% filter(!is.na(Aspartate.Transaminase..SGOT.AST....Serum)) %>% ggplot(aes(x=Aspartate.Transaminase..SGOT.AST....Serum)) + geom_histogram(alpha=0.5) 
```

## SGOT / SGPT Ratio
```{r}
df_mod %>% filter(!is.na( SGOT...SGPT.Ratio)) %>% ggplot(aes(x=SGOT...SGPT.Ratio   )) + geom_histogram(alpha=0.5) 
```


## Globulin
```{r}
df_mod %>% filter(!is.na( Globulin...Serum)) %>% ggplot(aes(x=Globulin...Serum   )) + geom_histogram(alpha=0.5) 
```



# General Scatter Plot

```{r}
pairs(~Total.Protein...Serum+ Indirect.Bilirubin...Serum  +Albumin...Serum  +Alkaline.Phosphatase...Serum  +Alanine.Transaminase..SGPT.ALT....Serum  +Aspartate.Transaminase..SGOT.AST....Serum  +SGOT...SGPT.Ratio  +Globulin...Serum , data= df_mod)

```


# Generar el data frame de los datos

```{r}

liver_group <- df_mod %>% select(Member.Id, Gender, Village, Date.of.birth, 
Total.Protein...Serum ,
Total.Bilirubin...Serum ,
Direct.Bilirubin...Serum ,
Indirect.Bilirubin...Serum ,
Albumin...Serum ,
Alkaline.Phosphatase...Serum ,
Alanine.Transaminase..SGPT.ALT....Serum ,
Aspartate.Transaminase..SGOT.AST....Serum ,
SGOT...SGPT.Ratio ,
Globulin...Serum) %>% filter( !is.na(Total.Protein...Serum) &
!is.na(Total.Bilirubin...Serum) &
!is.na(Direct.Bilirubin...Serum) &
!is.na(Indirect.Bilirubin...Serum) &
!is.na(Albumin...Serum) &
!is.na(Alkaline.Phosphatase...Serum) &
!is.na(Alanine.Transaminase..SGPT.ALT....Serum) &
!is.na(Aspartate.Transaminase..SGOT.AST....Serum) &
!is.na(SGOT...SGPT.Ratio) &
!is.na(Globulin...Serum))

dim(liver_group )
    
```

# Add age group
```{r add_features02}
liver_group$Age.Group <-  as.integer( ( as.integer( format( Sys.Date(), "%Y") ) - as.integer(format(as.Date(liver_group$Date.of.birth), "%Y")) ) / 10) * 10
```


```{r}
liver_group %>% ggplot(aes(x=Total.Protein...Serum, y=Indirect.Bilirubin...Serum )) + geom_point()


```

# Total Protein by Age Group
```{r}
liver_group %>% ggplot(aes(x=Age.Group, y=Total.Protein...Serum)) + geom_point()
```

# Out of range

```{r}
df_mod %>% filter(!is.na(Total.Protein...Serum) & ( Total.Protein...Serum > 8.3 | Total.Protein...Serum < 6)) 
```